- name: Download NeoForge installer
  get_url:
    url: "{{ mc_neoforge_installer_url }}"
    dest: "{{ mc_dir }}/neoforge-installer.jar"
    mode: "0644"
  when: mc_neoforge_installer_url is defined

- name: Set ownership of NeoForge installer
  file:
    path: "{{ mc_dir }}/neoforge-installer.jar"
    owner: "{{ mc_user }}"
    group: "{{ mc_user }}"
  when: mc_neoforge_installer_url is defined

# Run as mc_user via runuser, same workaround as Forge.
- name: Run NeoForge installer (install server)
  shell: runuser -u "{{ mc_user }}" -- java -jar neoforge-installer.jar --installServer
  args:
    chdir: "{{ mc_dir }}"
    creates: "{{ mc_dir }}/run.sh"
  when: mc_neoforge_installer_url is defined

- name: Make run.sh executable (NeoForge)
  file:
    path: "{{ mc_dir }}/run.sh"
    mode: "0755"
  when: mc_neoforge_installer_url is defined

- name: Create user_jvm_args.txt for NeoForge (heap and extra flags)
  copy:
    dest: "{{ mc_dir }}/user_jvm_args.txt"
    content: "-Xmx{{ mc_jvm_heap }} {{ mc_jvm_flags | default('') }}"
    owner: "{{ mc_user }}"
    group: "{{ mc_user }}"
    mode: "0644"
  when: mc_neoforge_installer_url is defined

